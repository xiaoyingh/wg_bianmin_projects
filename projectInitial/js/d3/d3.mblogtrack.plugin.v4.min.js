function MblogTrackChart(a,b,c,d,e){this.container=$("#"+a),this.dataFile=b,this.width=void 0==e||null==e?this.container.width():e,this.callback=c,this.tree=null,this.diagonal=null,this.svg=null,this.nodes=null,this.links=null,this.node=null,this.link=null,this.rate=1.2,this.dragFlag=null,this.dragX=null,this.dragY=null,this.cutTitleLen=10,this.cutContentLen=50,this.showTitleFlag=!1,this.maxRtt=null,this.minRtt=null,this.maxFans=null,this.minFans=null,this.scale=1,this.transX=this.width/2,this.transY=this.width/2,this.zoomtype=void 0==d||null==d?1:d}MblogTrackChart.prototype.init=function(){var a=this;return a.container.empty(),1==a.zoomtype?a.container.get(0).onmousewheel=function(b){var c=0;return b.wheelDelta?c=b.wheelDelta:b.detail&&(c=b.detail),c>0?(a.scale=a.scale*a.rate,a.transX=a.transX>0?a.transX/a.rate:a.transX*a.rate,a.transY=a.transY>0?a.transY/a.rate:a.transY*a.rate):0>c&&(a.scale=a.scale/a.rate,a.transX=a.transX>0?a.transX*a.rate:a.transX/a.rate,a.transY=a.transY>0?a.transY*a.rate:a.transY/a.rate),$(a.svg[0][0]).attr("transform","scale("+a.scale+") translate("+a.transX+","+a.transY+")"),!1}:(a.container.append("<div ref='1' class='zoombtn mblogtrack-zoomin'>+</div><div ref='-1' class='zoombtn mblogtrack-zoomout'>-</div>"),a.container.delegate(".zoombtn","click",function(){var b=parseInt($(this).attr("ref"));b>0?(a.scale=a.scale*a.rate,a.transX=a.transX>0?a.transX/a.rate:a.transX*a.rate,a.transY=a.transY>0?a.transY/a.rate:a.transY*a.rate):0>b&&(a.scale=a.scale/a.rate,a.transX=a.transX>0?a.transX*a.rate:a.transX/a.rate,a.transY=a.transY>0?a.transY*a.rate:a.transY/a.rate),$(a.svg[0][0]).attr("transform","scale("+a.scale+") translate("+a.transX+","+a.transY+")")})),a.container.mousedown(function(b){a.dragFlag=!0,a.dragX=b.clientX,a.dragY=b.clientY,$("body").addClass("unselectable")}),a.container.mouseup(function(){a.dragFlag=!1,$("body").removeClass("unselectable")}),a.container.mousemove(function(b){a.dragFlag&&(a.transX=a.transX-(a.dragX-b.clientX),a.transY=a.transY-(a.dragY-b.clientY),$(a.svg[0][0]).attr("transform","scale("+a.scale+") translate("+a.transX+","+a.transY+")"),a.dragX=b.clientX,a.dragY=b.clientY)}),a.genChart(),a},MblogTrackChart.prototype.genChart=function(){var a=this;a.tree=d3.layout.tree().size([360,a.width]).separation(function(a,b){return(a.parent==b.parent?1:2)/a.depth}),a.diagonal=d3.svg.diagonal.radial().projection(function(a){return[a.y,a.x/180*Math.PI]}),a.svg=d3.select("#"+a.container.get(0).id).append("svg").attr("width",a.width).attr("height",a.width).append("g").attr("transform","scale("+a.scale+") translate("+a.transX+","+a.transY+")"),d3.json(a.dataFile,function(b,c){a.nodes=a.tree.nodes(c),a.links=a.tree.links(a.nodes),a.nodes[0].ishead=!0,a.link=a.svg.selectAll(".link").data(a.links).enter().append("path").attr("class","link").attr("d",a.diagonal),a.node=a.svg.selectAll(".node").data(a.nodes).enter().append("g").attr("style","fill:#fff").attr("class","node tagtext").attr("title",function(a){return a.content?a.content:a.name}).attr("content",function(a){return a.content}).attr("ref",function(a){return a.id}).attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y+")"}),a.node.append("circle").attr("r",3.5).attr("style",function(a){return void 0==a.color||null==a.color||""==a.color?"":"fill:"+a.color+";stroke:"+a.color}),a.node.append("text").attr("dy",".31em").attr("text-anchor",function(a){return a.x<180?"start":"end"}).attr("transform",function(a){return a.x<180?"translate(8)":"rotate(180)translate(-8)"}).text(function(b){return"1"==b.show||1==a.showTitleFlag?b.name:""}),$("g.node").mouseenter(function(){$(this).css("cursor","pointer")}).mouseleave(function(){$(this).css("cursor","default")}),a.callback&&a.callback(a.container)})},MblogTrackChart.prototype.updateChart=function(){var a=this;a.link.attr("style",function(b){return(b.source.ishead||a.compareRtt(b.source.rtt)&&a.compareFans(b.source.fans))&&(b.target.ishead||a.compareRtt(b.target.rtt)&&a.compareFans(b.target.fans))?"":"display:none;"}),a.node.attr("style",function(b){return b.ishead?"fill:#fff;":a.compareRtt(b.rtt)&&a.compareFans(b.fans)?"fill:#fff;":"display:none;"}),a.node.selectAll("text").text(function(b){return"1"==b.show||1==a.showTitleFlag?b.name:""})},MblogTrackChart.prototype.showTitle=function(a){this.showTitleFlag=a},MblogTrackChart.prototype.setMaxRtt=function(a){this.maxRtt=null==a?null:parseInt(a)},MblogTrackChart.prototype.setMinRtt=function(a){this.minRtt=null==a?null:parseInt(a)},MblogTrackChart.prototype.setMaxFans=function(a){this.maxFans=null==a?null:parseInt(a)},MblogTrackChart.prototype.setMinFans=function(a){this.minFans=null==a?null:parseInt(a)},MblogTrackChart.prototype.compareRtt=function(a){var b=this,c=!0,d=parseInt(a);return c=void 0!=a?null==b.maxRtt&&null==b.minRtt?!0:null==b.maxRtt&&b.minRtt<=d?!0:null==b.minRtt&&b.maxRtt>=d?!0:null!=b.maxRtt&&null!=b.minRtt&&b.minRtt<=d&&b.maxRtt>=d?!0:!1:!0},MblogTrackChart.prototype.compareFans=function(a){var b=this,c=!0,d=parseInt(a);return c=void 0!=a?null==b.maxFans&&null==b.minFans?!0:null==b.maxFans&&b.minFans<=d?!0:null==b.minFans&&b.maxFans>=d?!0:null!=b.maxFans&&null!=b.minFans&&b.minFans<=d&&b.maxFans>=d?!0:!1:!0};